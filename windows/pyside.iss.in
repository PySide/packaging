; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{45E0A4C1-4682-4F5E-9536-0E7DEB431BF0}
AppName=PySide
AppVerName=PySide @PYSIDE_VERSION@
AppVersion=@PYSIDE_VERSION@
AppPublisher=PySide Team
AppPublisherURL=http://www.pyside.org
AppSupportURL=http://www.pyside.org
AppUpdatesURL=http://www.pyside.org
AppComments=Python bindings for Qt
AppCopyright=Copyright (C) 2010 Nokia Corporation and/or its subsidiary(-ies).
AppContact=contact@pyside.org
CreateAppDir=no
LicenseFile=@SOURCE_DIR@\pyside\COPYING
OutputBaseFilename=pyside-@PYSIDE_VERSION@-py@PYTHON_VERSION@
Compression=lzma
SolidCompression=yes

[Files]
; Required libraries
Source: "@INSTALL_DIR@\bin\shiboken.dll"; DestDir: "{sys}"; Flags: confirmoverwrite sharedfile ignoreversion
Source: "@INSTALL_DIR@\bin\pyside.dll"; DestDir: "{sys}"; Flags: confirmoverwrite sharedfile ignoreversion
Source: "@INSTALL_DIR@\lib\site-packages\PySide\*"; DestDir: "{code:getPythonPath}\Lib\site-packages\PySide"; Flags: confirmoverwrite ignoreversion

[Code]
var
  PythonPath : String;
  PythonPathPage : TInputDirWizardPage;

{ Returns the Python Path }
function getPythonPath(Param : String) : String;
begin
  Result := PythonPath;
end;

procedure InitializeWizard;
var
  Found : Boolean;
begin
  { Try to detect Python }
  Found := RegQueryStringValue(HKEY_LOCAL_MACHINE, 'Software\Python\PythonCore\@PYTHON_VERSION@\InstallPath', '', PythonPath);
  if not Found then
    RegQueryStringValue(HKEY_CURRENT_USER, 'Software\Python\PythonCore\@PYTHON_VERSION@\InstallPath', '', PythonPath);
  PythonPathPage := CreateInputDirPage(wpLicense,
                                      'Select Python directory',
                                      'Where Python @PYTHON_VERSION@ is installed in your computer?',
                                      'This version of PySide requires Python @PYTHON_VERSION@, please inform where did you have it installed.',
                                      False,
                                      '');
  PythonPathPage.Add('');
  PythonPathPage.Values[0] := PythonPath;
end;

function NextButtonClick(CurPageID : Integer): Boolean;
var
  ProcResult : Integer;
begin
  if CurPageID = PythonPathPage.ID then
  begin
    {Check if the choosen Python path is valid}
    ExecAsOriginalUser(PythonPathPage.Values[0] + '\python.exe',
                       '-c "import sys;assert ' #39 '%d.%d' #39 ' % sys.version_info[:2] == ' #39 '@PYTHON_VERSION@' #39 '"',
                       PythonPathPage.Values[0],
                       SW_HIDE,
                       ewWaitUntilTerminated,
                       ProcResult);
    if ProcResult <> 0 then
    begin
      MsgBox('Unable to find Python @PYTHON_VERSION@ in the specified directory.', mbError, MB_OK);
      Result := False;
    end
    else
    begin
      PythonPath := PythonPathPage.Values[0];
      Result := True;
    end;
  end
  else
    Result := True;
end;

function UpdateReadyMemo(Space, NewLine, MemoUserInfoInfo, MemoDirInfo, MemoTypeInfo,
  MemoComponentsInfo, MemoGroupInfo, MemoTasksInfo: String): String;
var
  S: String;
  sys : String;
begin
  sys := ExpandConstant('{sys}');
  S := '';
  S := S + 'Python modules will be installed on::' + NewLine;
  S := S + Space + PythonPath + '\Lib\site-packages\PySide' + NewLine;
  S := S + NewLine;

  S := S + 'The following support libraries will be installed on foo:' + NewLine;
  S := S + Space + sys + '\shiboken.dll' + NewLine;
  S := S + Space + sys + '\pyside.dll' + NewLine;
  S := S + NewLine;
  S := S + 'Note:' + NewLine;
  S := S + Space + '>>>>>>>>>>> You need Qt >= @QT_VERSION@ to use PySide. <<<<<<<<<<<' + NewLine;
  S := S + Space + 'Be sure to use the Qt library compiled for MSVC2008 and add it to your' + NewLine;
  S := S + 'system PATH.' + NewLine;
  S := S + NewLine;
  S := S + Space + 'If you do not have Qt installed yet, you can find it at:' + NewLine;
  S := S + Space + 'http://qt.nokia.com/downloads/windows-cpp-vs2008';
  Result := S;
end;
